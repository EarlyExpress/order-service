# Order Service

Early Express ë¬¼ë¥˜ í”Œë«í¼ì˜ **ì£¼ë¬¸ ê´€ë¦¬ ì„œë¹„ìŠ¤**ì…ë‹ˆë‹¤. ì£¼ë¬¸ ìƒì„±ë¶€í„° ë°°ì†¡ ì™„ë£Œê¹Œì§€ì˜ ì „ì²´ ì£¼ë¬¸ ìƒëª…ì£¼ê¸°ë¥¼ ê´€ë¦¬í•˜ë©°, **Saga íŒ¨í„´**ì„ í†µí•´ ë¶„ì‚° íŠ¸ëœì­ì…˜ì„ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜í•©ë‹ˆë‹¤.

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ê¸°ìˆ  ìŠ¤íƒ](#ê¸°ìˆ -ìŠ¤íƒ)
3. [ì•„í‚¤í…ì²˜](#ì•„í‚¤í…ì²˜)
4. [ë„ë©”ì¸ ëª¨ë¸](#ë„ë©”ì¸-ëª¨ë¸)
5. [Saga íŒ¨í„´](#saga-íŒ¨í„´)
6. [API ì—”ë“œí¬ì¸íŠ¸](#api-ì—”ë“œí¬ì¸íŠ¸)
7. [Kafka ì´ë²¤íŠ¸](#kafka-ì´ë²¤íŠ¸)
8. [í™˜ê²½ ì„¤ì •](#í™˜ê²½-ì„¤ì •)
9. [ì‹¤í–‰ ë°©ë²•](#ì‹¤í–‰-ë°©ë²•)
10. [í”„ë¡œì íŠ¸ êµ¬ì¡°](#í”„ë¡œì íŠ¸-êµ¬ì¡°)

---

## ê°œìš”

Order ServiceëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì˜ í•µì‹¬ ì„œë¹„ìŠ¤ë¡œ, ë‹¤ìŒ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤:

- **ì£¼ë¬¸ ìƒëª…ì£¼ê¸° ê´€ë¦¬**: ìƒì„± â†’ Saga ì‹¤í–‰ â†’ í™•ì • â†’ ë°°ì†¡ â†’ ì™„ë£Œ/ì·¨ì†Œ
- **Saga ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜**: ì¬ê³  ì˜ˆì•½, ê²°ì œ ê²€ì¦, ë°°ì†¡ ìƒì„± ë“± ë¶„ì‚° íŠ¸ëœì­ì…˜ ì¡°ìœ¨
- **AI ê¸°ë°˜ ë°°ì†¡ ê³„íš**: Hub Service + AI Service ì—°ë™ìœ¼ë¡œ ìµœì  ê²½ë¡œ ë° ì‹œê°„ ê³„ì‚°
- **ì‹¤ì‹œê°„ ìƒíƒœ ì¶”ì **: ì£¼ë¬¸/ë°°ì†¡ ìƒíƒœ ë³€ê²½ ì´ë²¤íŠ¸ ë°œí–‰
- **ë³´ìƒ íŠ¸ëœì­ì…˜**: ì‹¤íŒ¨ ì‹œ ìë™ ë¡¤ë°± (ì¬ê³  ë³µì›, ê²°ì œ ì·¨ì†Œ ë“±)

---

## ê¸°ìˆ  ìŠ¤íƒ

| êµ¬ë¶„ | ê¸°ìˆ  |
|------|------|
| **Framework** | Spring Boot 3.5.7 |
| **Language** | Java 21 |
| **Database** | PostgreSQL |
| **Messaging** | Apache Kafka |
| **Service Discovery** | Netflix Eureka |
| **Security** | OAuth 2.0 Resource Server (Keycloak) |
| **Service Communication** | OpenFeign |
| **Build Tool** | Gradle |

---

## ì•„í‚¤í…ì²˜

### ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                  Order Service                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Presentation Layer                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ CompanyUserOrder  â”‚ â”‚ HubManagerOrder   â”‚ â”‚ MasterOrder       â”‚                  â”‚
â”‚  â”‚ Controller        â”‚ â”‚ Controller        â”‚ â”‚ Controller        â”‚                  â”‚
â”‚  â”‚ /web/company-user â”‚ â”‚ /web/hub-manager  â”‚ â”‚ /web/master       â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Application Layer                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚    OrderCommandService   â”‚  â”‚    OrderQueryService     â”‚                         â”‚
â”‚  â”‚    â€¢ createOrder()       â”‚  â”‚    â€¢ getOrderById()      â”‚                         â”‚
â”‚  â”‚    â€¢ cancelOrder()       â”‚  â”‚    â€¢ searchOrders()      â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚    OrderSagaService      â”‚  â”‚  OrderCompensationServiceâ”‚                         â”‚
â”‚  â”‚    â€¢ executeSaga()       â”‚  â”‚    â€¢ handleRefunded()    â”‚                         â”‚
â”‚  â”‚    â€¢ compensate()        â”‚  â”‚    â€¢ restoreStock()      â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Domain Layer                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Order (Aggregate Root)                     OrderSaga (Aggregate Root)      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚    â”‚
â”‚  â”‚  â”‚ CompanyInfo â”‚ â”‚ ProductInfo â”‚           â”‚ SagaStep    â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ AmountInfo  â”‚ â”‚ ReceiverInfoâ”‚           â”‚ StepHistory â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ DeliveryInfoâ”‚ â”‚ RequestInfo â”‚           â”‚ Compensationâ”‚                  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Infrastructure Layer                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   PostgreSQL   â”‚ â”‚ Kafka Producer â”‚ â”‚ Kafka Consumer â”‚ â”‚  Feign Client  â”‚        â”‚
â”‚  â”‚   Repository   â”‚ â”‚ (4 í† í”½ ë°œí–‰)   â”‚ â”‚ (2 í† í”½ ìˆ˜ì‹ )   â”‚ â”‚ (5ê°œ ì„œë¹„ìŠ¤)   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì„œë¹„ìŠ¤ ì—°ë™ êµ¬ì¡°

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   AI Service    â”‚
                                    â”‚ (ì‹œê°„ ê³„ì‚°)      â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚ Feign
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚ Inventory       â”‚â—€â”€â”€â”€ Feign â”€â”€â”€â”           â”‚
â”‚ Service         â”‚              â”‚           â”‚
â”‚ (ì¬ê³  ì˜ˆì•½/í•´ì œ) â”‚              â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚           â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                         â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Payment         â”‚â—€â”€â”€â”€â”€â”€â”€â”‚      Order Service      â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚ Hub Service     â”‚
â”‚ Service         â”‚ Kafka â”‚                         â”‚ Feign â”‚ (ê²½ë¡œ ê³„ì‚°)      â”‚
â”‚ (ê²°ì œ/í™˜ë¶ˆ)      â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚                         â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                         â”‚
                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚           â”‚
â”‚ Hub Delivery    â”‚â—€â”€â”€â”€ Feign â”€â”€â”€â”¤           â”‚
â”‚ Service         â”‚              â”‚           â”‚
â”‚ (í—ˆë¸Œ ë°°ì†¡)      â”‚              â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚           â”‚
                                 â”‚           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚           â”‚
â”‚ Last Mile       â”‚â—€â”€â”€â”€ Feign â”€â”€â”€â”¤           â”‚
â”‚ Delivery Serviceâ”‚              â”‚           â”‚
â”‚ (ìµœì¢… ë°°ì†¡)      â”‚              â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚           â”‚
                                 â”‚           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚           â”‚
â”‚ Track Service   â”‚â—€â”€â”€â”€ Kafka â”€â”€â”€â”˜           â”‚
â”‚ (ë°°ì†¡ ì¶”ì )      â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
                                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚ Notification    â”‚â—€â”€â”€â”€ Kafka â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Service         â”‚
â”‚ (ì•Œë¦¼ ë°œì†¡)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë„ë©”ì¸ ëª¨ë¸

### Order (Aggregate Root)

```java
public class Order {
    // ì‹ë³„ì
    private OrderId id;                      // UUID
    private OrderNumber orderNumber;         // ORD-YYYYMMDD-XXX
    
    // ì—…ì²´ ì •ë³´
    private CompanyInfo companyInfo;         // ê³µê¸‰/ìˆ˜ë ¹ ì—…ì²´ ë° í—ˆë¸Œ
    private String destinationHubId;         // ì‹¤ì œ ë„ì°© í—ˆë¸Œ (Hub Service ê²°ì •)
    
    // ìƒí’ˆ ì •ë³´
    private ProductInfo productInfo;         // ìƒí’ˆ ID, í—ˆë¸Œ, ìˆ˜ëŸ‰
    
    // ë°°ì†¡ ì •ë³´
    private DeliveryInfo deliveryInfo;       // í—ˆë¸Œ/ìµœì¢… ë°°ì†¡ ID
    private DeliveryProgressInfo deliveryProgressInfo;  // ì‹¤ì œ ë°°ì†¡ ì§„í–‰
    
    // ìˆ˜ë ¹ì ì •ë³´
    private ReceiverInfo receiverInfo;       // ì´ë¦„, ì—°ë½ì²˜, ì£¼ì†Œ
    
    // ìš”ì²­ì‚¬í•­
    private RequestInfo requestInfo;         // ë‚©í’ˆ í¬ë§ ì¼ì‹œ, íŠ¹ë³„ ìš”ì²­
    
    // AI ê³„ì‚° ê²°ê³¼
    private AiCalculationResult aiCalculationResult;  // ê²½ë¡œ, ë°œì†¡ ì‹œí•œ, ì˜ˆìƒ ë„ì°©
    
    // ìƒíƒœ
    private OrderStatus status;
    
    // ê¸ˆì•¡ ì •ë³´
    private AmountInfo amountInfo;           // ë‹¨ê°€, ì´ì•¡, Payment ID
    
    // PG ê²°ì œ ì •ë³´
    private PgPaymentInfo pgPaymentInfo;     // PGì‚¬, ê²°ì œ ID, ê²°ì œ í‚¤
    
    // ì·¨ì†Œ ì •ë³´
    private String cancelReason;
    private LocalDateTime cancelledAt;
    
    // Audit
    private String createdBy;
    private LocalDateTime createdAt;
}
```

### Value Objects

| Value Object | ì„¤ëª… | ì£¼ìš” í•„ë“œ |
|--------------|------|----------|
| `OrderId` | ì£¼ë¬¸ ê³ ìœ  ID | UUID |
| `OrderNumber` | ì£¼ë¬¸ ë²ˆí˜¸ | ORD-YYYYMMDD-XXX |
| `CompanyInfo` | ì—…ì²´ ì •ë³´ | supplierCompanyId, supplierHubId, receiverCompanyId, receiverHubId |
| `ProductInfo` | ìƒí’ˆ ì •ë³´ | productId, productHubId, quantity |
| `AmountInfo` | ê¸ˆì•¡ ì •ë³´ | unitPrice, totalAmount, paymentId |
| `ReceiverInfo` | ìˆ˜ë ¹ì ì •ë³´ | name, phone, email, address, postalCode |
| `RequestInfo` | ìš”ì²­ì‚¬í•­ | requestedDeliveryDate, requestedDeliveryTime, specialInstructions |
| `DeliveryInfo` | ë°°ì†¡ ì •ë³´ | requiresHubDelivery, hubDeliveryId, lastMileDeliveryId |
| `DeliveryProgressInfo` | ë°°ì†¡ ì§„í–‰ | actualDepartureTime, hubArrivalTime, actualDeliveryTime, signature |
| `AiCalculationResult` | AI ê³„ì‚° ê²°ê³¼ | routeInfoJson, calculatedDepartureDeadline, estimatedDeliveryTime |
| `PgPaymentInfo` | PG ê²°ì œ ì •ë³´ | pgProvider, pgPaymentId, pgPaymentKey |

### OrderStatus (ì£¼ë¬¸ ìƒíƒœ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ì£¼ë¬¸ ìƒíƒœ íë¦„ë„                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ì£¼ë¬¸ ìƒì„±]
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PENDING â”‚â”€â”€â”€â”€â–¶â”‚ STOCK_CHECKINGâ”‚â”€â”€â”€â”€â–¶â”‚ STOCK_RESERVED â”‚â”€â”€â”€â”€â–¶â”‚PAYMENT_VERIFYINGâ”‚
â”‚ ì£¼ë¬¸ìƒì„± â”‚     â”‚ ì¬ê³ í™•ì¸ì¤‘     â”‚     â”‚ ì¬ê³ ì˜ˆì•½ì™„ë£Œ    â”‚     â”‚ ê²°ì œê²€ì¦ì¤‘       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                      â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PAYMENT_VERIFIEDâ”‚â”€â”€â”€â”€â–¶â”‚ ROUTE_CALCULATINGâ”‚â”€â”€â”€â”€â–¶â”‚DELIVERY_    â”‚
â”‚ ê²°ì œê²€ì¦ì™„ë£Œ     â”‚     â”‚ ê²½ë¡œê³„ì‚°ì¤‘        â”‚     â”‚CREATING     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ ë°°ì†¡ìƒì„±ì¤‘   â”‚
                                                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Saga ì™„ë£Œ - ì£¼ë¬¸ í™•ì •                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
                                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                 â”‚  CONFIRMED  â”‚
                                                 â”‚  ì£¼ë¬¸í™•ì •    â”‚
                                                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                   â”‚                   â”‚
    â–¼                                                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HUB_WAITING â”‚                                  â”‚HUB_IN_TRANSITâ”‚     â”‚LAST_MILE_   â”‚
â”‚ í—ˆë¸ŒëŒ€ê¸°ì¤‘   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ í—ˆë¸Œë°°ì†¡ì¤‘   â”‚â”€â”€â”€â”€â–¶â”‚READY        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  (í—ˆë¸Œë°°ì†¡ í•„ìš” ì‹œ)               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ì—…ì²´ë°°ì†¡ì¤€ë¹„  â”‚
                                                        â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                        â–¼                   â”‚
                                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
                                                 â”‚ HUB_ARRIVED â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚ ìˆ˜ë ¹í—ˆë¸Œë„ì°© â”‚
                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
                                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                 â”‚ IN_DELIVERY â”‚
                                                 â”‚ ë°°ì†¡ì¤‘       â”‚
                                                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                   â”‚                   â”‚
                    â–¼                                   â–¼                   â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚  COMPLETED  â”‚                     â”‚  CANCELLED  â”‚     â”‚   FAILED    â”‚
             â”‚  ë°°ì†¡ì™„ë£Œ    â”‚                     â”‚  ì·¨ì†Œë¨      â”‚     â”‚   ì‹¤íŒ¨      â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
                                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                 â”‚ COMPENSATED â”‚
                                                 â”‚ ë³´ìƒì™„ë£Œ     â”‚
                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Saga íŒ¨í„´

### OrderSaga (Aggregate Root)

Order ServiceëŠ” **Saga Orchestration íŒ¨í„´**ì„ ì‚¬ìš©í•˜ì—¬ ë¶„ì‚° íŠ¸ëœì­ì…˜ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.

```java
public class OrderSaga {
    private SagaId sagaId;
    private OrderId orderId;
    
    private SagaStatus status;           // PENDING â†’ IN_PROGRESS â†’ COMPLETED/COMPENSATED
    private SagaStep currentStep;        // í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ Step
    
    private CompensationData compensationData;  // ë³´ìƒì— í•„ìš”í•œ ë°ì´í„°
    
    private LocalDateTime startedAt;
    private LocalDateTime completedAt;
    private String failureReason;
    
    private List<SagaStepHistory> stepHistory;  // Step ì‹¤í–‰ ì´ë ¥
}
```

### Saga Steps

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Saga Step íë¦„ë„                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Forward Steps (ì •ë°©í–¥)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STOCK_RESERVEâ”‚â”€â”€â”€â–¶â”‚PAYMENT_VERIFYâ”‚â”€â”€â”€â–¶â”‚ROUTE_CALCULATEâ”€â”€â”€â–¶â”‚HUB_DELIVERY_ â”‚
â”‚ ì¬ê³  ì˜ˆì•½     â”‚    â”‚ ê²°ì œ ê²€ì¦     â”‚    â”‚ ê²½ë¡œ ê³„ì‚°     â”‚    â”‚CREATE        â”‚
â”‚ [í•„ìˆ˜]       â”‚    â”‚ [í•„ìˆ˜]       â”‚    â”‚ [ì¡°ê±´ë¶€]      â”‚    â”‚í—ˆë¸Œë°°ì†¡ ìƒì„±  â”‚
â”‚ ë³´ìƒ: ë³µì›   â”‚    â”‚ ë³´ìƒ: ì·¨ì†Œ   â”‚    â”‚ ë³´ìƒ: ì—†ìŒ   â”‚    â”‚ [ì¡°ê±´ë¶€]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ ë³´ìƒ: ì·¨ì†Œ   â”‚
                                                            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚LAST_MILE_DELIVERYâ”‚â”€â”€â”€â–¶â”‚NOTIFICATION_SEND â”‚â”€â”€â”€â–¶â”‚  TRACKING_START  â”‚
â”‚CREATE            â”‚    â”‚ ì•Œë¦¼ ë°œì†¡         â”‚    â”‚ ì¶”ì  ì‹œì‘         â”‚
â”‚ì—…ì²´ë°°ì†¡ ìƒì„±      â”‚    â”‚ [Best Effort]    â”‚    â”‚ [Best Effort]    â”‚
â”‚ [í•„ìˆ˜]           â”‚    â”‚ ë³´ìƒ: ì—†ìŒ       â”‚    â”‚ ë³´ìƒ: ì—†ìŒ       â”‚
â”‚ ë³´ìƒ: ì·¨ì†Œ       â”‚    â”‚                  â”‚    â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â–¼
                                                   [Saga ì™„ë£Œ]


Compensation Steps (ë³´ìƒ - ì—­ìˆœ)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì‹¤íŒ¨ ë°œìƒ ì‹œ ì™„ë£Œëœ Stepë“¤ì„ ì—­ìˆœìœ¼ë¡œ ë³´ìƒ:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚LAST_MILE_DELIVERYâ”‚â—€â”€â”€â”€â”‚HUB_DELIVERY_     â”‚â—€â”€â”€â”€â”‚ PAYMENT_CANCEL   â”‚â—€â”€â”€â”€â”‚ STOCK_RESTOREâ”‚
â”‚CANCEL            â”‚    â”‚CANCEL            â”‚    â”‚ ê²°ì œ ì·¨ì†Œ/í™˜ë¶ˆ   â”‚    â”‚ ì¬ê³  ë³µì›     â”‚
â”‚ì—…ì²´ë°°ì†¡ ì·¨ì†Œ      â”‚    â”‚í—ˆë¸Œë°°ì†¡ ì·¨ì†Œ      â”‚    â”‚                  â”‚    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SagaStatus

| ìƒíƒœ | ì„¤ëª… |
|------|------|
| `PENDING` | ì‹œì‘ ëŒ€ê¸° |
| `IN_PROGRESS` | ì§„í–‰ ì¤‘ |
| `COMPLETED` | ëª¨ë“  Step ì„±ê³µ ì™„ë£Œ |
| `COMPENSATING` | ë³´ìƒ íŠ¸ëœì­ì…˜ ì‹¤í–‰ ì¤‘ |
| `COMPENSATED` | ë³´ìƒ ì™„ë£Œ (ë¡¤ë°±ë¨) |
| `COMPENSATION_FAILED` | ë³´ìƒ ì‹¤íŒ¨ (ìˆ˜ë™ ê°œì… í•„ìš”) |
| `FAILED` | ì‹¤íŒ¨ |

### StepStatus

| ìƒíƒœ | ì„¤ëª… |
|------|------|
| `PENDING` | ì‹¤í–‰ ëŒ€ê¸° |
| `IN_PROGRESS` | ì‹¤í–‰ ì¤‘ |
| `SUCCESS` | ì„±ê³µ |
| `FAILED` | ì‹¤íŒ¨ |
| `COMPENSATED` | ë³´ìƒ ì™„ë£Œ |

---

## API ì—”ë“œí¬ì¸íŠ¸

### Company User API (ì—…ì²´ ì‚¬ìš©ììš©)

**Base Path**: `/v1/order/web/company-user`

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| `POST` | `/orders` | ì£¼ë¬¸ ìƒì„± |
| `GET` | `/my-orders` | ë‚´ ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ |
| `GET` | `/orders/{id}` | ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ |
| `POST` | `/cancel/{id}` | ì£¼ë¬¸ ì·¨ì†Œ |

#### ì£¼ë¬¸ ìƒì„± ìš”ì²­/ì‘ë‹µ

```http
POST /v1/order/web/company-user/orders
X-User-Id: user-001
Content-Type: application/json
```

**Request**
```json
{
  "supplierCompanyId": "company-001",
  "supplierHubId": "hub-seoul-001",
  "receiverCompanyId": "company-002",
  "receiverHubId": "hub-busan-001",
  "productId": "prod-001",
  "quantity": 100,
  "unitPrice": 15000.00,
  "receiverName": "ê¹€ìˆ˜ë ¹",
  "receiverPhone": "010-1234-5678",
  "receiverEmail": "receiver@example.com",
  "deliveryAddress": "ë¶€ì‚°ê´‘ì—­ì‹œ í•´ìš´ëŒ€êµ¬ ì„¼í…€ë¡œ 123",
  "deliveryAddressDetail": "Bë™ 501í˜¸",
  "deliveryPostalCode": "48058",
  "deliveryNote": "ê²½ë¹„ì‹¤ì— ë§¡ê²¨ì£¼ì„¸ìš”",
  "requestedDeliveryDate": "2025-01-20",
  "requestedDeliveryTime": "14:00:00",
  "specialInstructions": "íŒŒì† ì£¼ì˜",
  "pgProvider": "TOSS",
  "pgPaymentId": "pg-payment-001"
}
```

**Response (200 OK)**
```json
{
  "success": true,
  "data": {
    "orderId": "order-uuid-001",
    "orderNumber": "ORD-20250115-001",
    "status": "PENDING",
    "statusDescription": "ì£¼ë¬¸ ìƒì„±",
    "totalAmount": 1500000.00,
    "requestedDeliveryDate": "2025-01-20T14:00:00",
    "createdAt": "2025-01-15T10:30:00",
    "message": "ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. ì¬ê³  í™•ì¸ ì¤‘ì…ë‹ˆë‹¤."
  },
  "message": "ì£¼ë¬¸ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

#### ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ ì‘ë‹µ

```json
{
  "success": true,
  "data": {
    "orderId": "order-uuid-001",
    "orderNumber": "ORD-20250115-001",
    "status": "CONFIRMED",
    "statusDescription": "ì£¼ë¬¸ í™•ì •",
    "companyInfo": {
      "supplierCompanyId": "company-001",
      "supplierHubId": "hub-seoul-001",
      "receiverCompanyId": "company-002",
      "receiverHubId": "hub-busan-001"
    },
    "productInfo": {
      "productId": "prod-001",
      "productHubId": "hub-seoul-001",
      "quantity": 100
    },
    "amountInfo": {
      "unitPrice": 15000.00,
      "totalAmount": 1500000.00,
      "paymentId": "payment-001"
    },
    "receiverInfo": {
      "receiverName": "ê¹€ìˆ˜ë ¹",
      "receiverPhone": "010-1234-5678",
      "receiverEmail": "receiver@example.com",
      "deliveryAddress": "ë¶€ì‚°ê´‘ì—­ì‹œ í•´ìš´ëŒ€êµ¬ ì„¼í…€ë¡œ 123",
      "deliveryAddressDetail": "Bë™ 501í˜¸",
      "deliveryPostalCode": "48058",
      "deliveryNote": "ê²½ë¹„ì‹¤ì— ë§¡ê²¨ì£¼ì„¸ìš”"
    },
    "requestInfo": {
      "requestedDeliveryDate": "2025-01-20",
      "requestedDeliveryTime": "14:00:00",
      "specialInstructions": "íŒŒì† ì£¼ì˜"
    },
    "deliveryInfo": {
      "requiresHubDelivery": true,
      "hubDeliveryId": "hub-delivery-001",
      "lastMileDeliveryId": "last-mile-001"
    },
    "deliveryProgressInfo": {
      "actualDepartureTime": null,
      "hubArrivalTime": null,
      "finalDeliveryStartTime": null,
      "actualDeliveryTime": null,
      "signature": null,
      "actualReceiverName": null
    },
    "estimatedDeliveryTime": "2025-01-20T13:30:00",
    "calculatedDepartureDeadline": "2025-01-19T18:00:00",
    "pgProvider": "TOSS",
    "pgPaymentId": "pg-payment-001",
    "createdAt": "2025-01-15T10:30:00",
    "cancelReason": null,
    "cancelledAt": null,
    "cancellable": true
  }
}
```

---

### Hub Manager API (í—ˆë¸Œ ê´€ë¦¬ììš©)

**Base Path**: `/v1/order/web/hub-manager`

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| `GET` | `/hub-orders` | í—ˆë¸Œ ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ (í˜ì´ì§•) |
| `GET` | `/hub-orders/search` | í—ˆë¸Œ ì£¼ë¬¸ ê²€ìƒ‰ (í•„í„°ë§) |
| `GET` | `/orders/{id}` | ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ (í—ˆë¸Œ ê´€ì ) |

#### í—ˆë¸Œ ì£¼ë¬¸ ê²€ìƒ‰

```http
GET /v1/order/web/hub-manager/hub-orders/search?status=CONFIRMED&startDate=2025-01-01T00:00:00&endDate=2025-01-31T23:59:59
X-Hub-Id: hub-seoul-001
```

**Response**
```json
{
  "success": true,
  "data": {
    "content": [
      {
        "orderId": "order-uuid-001",
        "orderNumber": "ORD-20250115-001",
        "status": "CONFIRMED",
        "statusDescription": "ì£¼ë¬¸ í™•ì •",
        "supplierCompanyId": "company-001",
        "receiverCompanyId": "company-002",
        "productId": "prod-001",
        "quantity": 100,
        "totalAmount": 1500000.00,
        "receiverName": "ê¹€ìˆ˜ë ¹",
        "requestedDeliveryDate": "2025-01-20T14:00:00",
        "createdAt": "2025-01-15T10:30:00"
      }
    ],
    "pageInfo": {
      "page": 0,
      "size": 20,
      "totalElements": 1,
      "totalPages": 1
    }
  }
}
```

#### í—ˆë¸Œ ì£¼ë¬¸ ìƒì„¸ ì‘ë‹µ (AI ê³„ì‚° ê²°ê³¼ í¬í•¨)

```json
{
  "success": true,
  "data": {
    "orderId": "order-uuid-001",
    "orderNumber": "ORD-20250115-001",
    "status": "CONFIRMED",
    "statusDescription": "ì£¼ë¬¸ í™•ì •",
    "companyInfo": { ... },
    "destinationHubId": "hub-busan-001",
    "productInfo": { ... },
    "receiverInfo": { ... },
    "requestInfo": { ... },
    "deliveryInfo": { ... },
    "deliveryProgressInfo": { ... },
    "aiCalculationResult": {
      "routeInfoJson": "{\"hubs\":[\"hub-seoul-001\",\"hub-daejeon-001\",\"hub-busan-001\"],\"totalDistance\":450,\"segments\":[...]}",
      "calculatedDepartureDeadline": "2025-01-19T18:00:00",
      "estimatedDeliveryTime": "2025-01-20T13:30:00",
      "aiMessage": "ì„œìš¸â†’ëŒ€ì „â†’ë¶€ì‚° ê²½ë¡œë¡œ ì´ 450km, ì˜ˆìƒ ì†Œìš”ì‹œê°„ 19ì‹œê°„ 30ë¶„"
    },
    "createdAt": "2025-01-15T10:30:00",
    "departureDeadlinePassed": false
  }
}
```

---

### Master API (ë§ˆìŠ¤í„° ê´€ë¦¬ììš©)

**Base Path**: `/v1/order/web/master`

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| `GET` | `/orders` | ì „ì²´ ì£¼ë¬¸ ê²€ìƒ‰ (í˜ì´ì§•) |
| `GET` | `/orders/all` | ì „ì²´ ì£¼ë¬¸ ê²€ìƒ‰ (ì‚­ì œ í¬í•¨) |
| `GET` | `/orders/{id}` | ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ (ì „ì²´ ì •ë³´) |
| `GET` | `/orders/{id}/with-deleted` | ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ (ì‚­ì œ í¬í•¨) |
| `GET` | `/orders/upcoming-deadline` | ë°œì†¡ ì‹œí•œ ì„ë°• ì£¼ë¬¸ ì¡°íšŒ |
| `GET` | `/orders/overdue` | ë°œì†¡ ì‹œí•œ ì´ˆê³¼ ì£¼ë¬¸ ì¡°íšŒ |
| `GET` | `/orders/{id}/saga` | Saga ìƒíƒœ ì¡°íšŒ (TODO) |

#### ë§ˆìŠ¤í„° ì£¼ë¬¸ ìƒì„¸ ì‘ë‹µ (Saga ì •ë³´ í¬í•¨)

```json
{
  "success": true,
  "data": {
    "orderId": "order-uuid-001",
    "orderNumber": "ORD-20250115-001",
    "status": "CONFIRMED",
    "statusDescription": "ì£¼ë¬¸ í™•ì •",
    "companyInfo": { ... },
    "destinationHubId": "hub-busan-001",
    "productInfo": { ... },
    "amountInfo": { ... },
    "receiverInfo": { ... },
    "requestInfo": { ... },
    "deliveryInfo": { ... },
    "deliveryProgressInfo": { ... },
    "aiCalculationResult": { ... },
    "pgPaymentInfo": {
      "pgProvider": "TOSS",
      "pgPaymentId": "pg-payment-001",
      "pgPaymentKey": "pg-key-001"
    },
    "sagaInfo": {
      "sagaId": "saga-uuid-001",
      "orderId": "order-uuid-001",
      "status": "COMPLETED",
      "statusDescription": "ì™„ë£Œ",
      "currentStep": "TRACKING_START",
      "currentStepDescription": "ì¶”ì  ì‹œì‘",
      "startedAt": "2025-01-15T10:30:05",
      "completedAt": "2025-01-15T10:30:15",
      "failureReason": null,
      "stepHistory": [
        {
          "step": "STOCK_RESERVE",
          "stepDescription": "ì¬ê³  ì˜ˆì•½",
          "status": "SUCCESS",
          "statusDescription": "ì„±ê³µ",
          "errorMessage": null,
          "startedAt": "2025-01-15T10:30:05",
          "completedAt": "2025-01-15T10:30:06",
          "retryCount": 0
        },
        {
          "step": "PAYMENT_VERIFY",
          "stepDescription": "ê²°ì œ ê²€ì¦",
          "status": "SUCCESS",
          "statusDescription": "ì„±ê³µ",
          "errorMessage": null,
          "startedAt": "2025-01-15T10:30:06",
          "completedAt": "2025-01-15T10:30:08",
          "retryCount": 0
        }
      ]
    },
    "createdBy": "user-001",
    "createdAt": "2025-01-15T10:30:00",
    "cancelReason": null,
    "cancelledAt": null,
    "cancellable": true,
    "departureDeadlinePassed": false,
    "completed": false
  }
}
```

---

## Kafka ì´ë²¤íŠ¸

### ì´ë²¤íŠ¸ íë¦„ë„

```
                                  Order Service
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                          â”‚
  Payment Service   â”‚                                          â”‚   Track Service
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚               â”‚ â”‚    â”‚ PaymentRefundedEventConsumer   â”‚   â”‚   â”‚               â”‚
  â”‚ payment-      â”‚â”€â”¼â”€â”€â”€â–¶â”‚                                â”‚   â”‚   â”‚ tracking-     â”‚
  â”‚ refunded      â”‚ â”‚    â”‚ â€¢ handlePaymentRefunded()      â”‚   â”‚   â”‚ start-        â”‚
  â”‚               â”‚ â”‚    â”‚ â†’ ì¬ê³  ë³µì› ì²˜ë¦¬                â”‚   â”‚â—€â”€â”€â”¼â”€requested     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚               â”‚
                    â”‚                                          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚               â”‚ â”‚    â”‚PaymentRefundFailedEventConsumerâ”‚   â”‚   Notification
  â”‚ payment-      â”‚â”€â”¼â”€â”€â”€â–¶â”‚                                â”‚   â”‚   Service
  â”‚ refund-failed â”‚ â”‚    â”‚ â€¢ handlePaymentRefundFailed()  â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚               â”‚ â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                          â”‚â—€â”€â”€â”¼â”€notification- â”‚
                    â”‚                                          â”‚   â”‚ events        â”‚
                    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚               â”‚
                    â”‚    â”‚  KafkaPaymentEventPublisher    â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚    â”‚                                â”‚   â”‚
                    â”‚    â”‚ â€¢ publishRefundRequested()     â”‚â”€â”€â”€â”¼â”€â”€â–¶ refund-requested
                    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     (â†’ Payment Service)
                    â”‚                                          â”‚
                    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                    â”‚    â”‚  KafkaTrackingEventPublisher   â”‚   â”‚
                    â”‚    â”‚                                â”‚â”€â”€â”€â”¼â”€â”€â–¶ tracking-start-requested
                    â”‚    â”‚ â€¢ publishTrackingStartRequestedâ”‚   â”‚     (â†’ Track Service)
                    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                    â”‚                                          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°œí–‰ ì´ë²¤íŠ¸ (Producer)

#### 1. refund-requested (â†’ Payment Service)

ì£¼ë¬¸ ì·¨ì†Œ ì‹œ ê²°ì œ í™˜ë¶ˆì„ ìš”ì²­í•©ë‹ˆë‹¤.

**í† í”½**: `refund-requested`

```json
{
  "eventId": "evt-uuid-001",
  "eventType": "REFUND_REQUESTED",
  "source": "order-service",
  "timestamp": "2025-01-15T11:00:00",
  "paymentId": "payment-001",
  "orderId": "order-uuid-001",
  "refundReason": "ê³ ê° ìš”ì²­ìœ¼ë¡œ ì£¼ë¬¸ ì·¨ì†Œ",
  "requestedAt": "2025-01-15T11:00:00"
}
```

---

#### 2. tracking-start-requested (â†’ Track Service)

Saga ì™„ë£Œ í›„ ë°°ì†¡ ì¶”ì  ì‹œì‘ì„ ìš”ì²­í•©ë‹ˆë‹¤.

**í† í”½**: `tracking-start-requested`

```json
{
  "eventId": "evt-uuid-002",
  "eventType": "TRACKING_START_REQUESTED",
  "source": "order-service",
  "timestamp": "2025-01-15T10:30:15",
  "orderId": "order-uuid-001",
  "orderNumber": "ORD-20250115-001",
  "hubDeliveryId": "hub-delivery-001",
  "lastMileDeliveryId": "last-mile-001",
  "originHubId": "hub-seoul-001",
  "destinationHubId": "hub-busan-001",
  "routingHub": "{\"hubs\":[\"hub-seoul-001\",\"hub-daejeon-001\",\"hub-busan-001\"]}",
  "requiresHubDelivery": true,
  "estimatedDeliveryTime": "2025-01-20T13:30:00",
  "requestedAt": "2025-01-15T10:30:15"
}
```

---

#### 3. notification-events (â†’ Notification Service)

ì£¼ë¬¸ ìƒíƒœ ë³€ê²½ ì‹œ ì•Œë¦¼ ë°œì†¡ì„ ìš”ì²­í•©ë‹ˆë‹¤.

**í† í”½**: `notification-events`

```json
{
  "eventId": "evt-uuid-003",
  "eventType": "NOTIFICATION_REQUESTED",
  "source": "order-service",
  "timestamp": "2025-01-15T10:30:15",
  "orderId": "order-uuid-001",
  "receiverName": "ê¹€ìˆ˜ë ¹",
  "receiverPhone": "010-1234-5678",
  "receiverEmail": "receiver@example.com",
  "orderNumber": "ORD-20250115-001",
  "estimatedDeliveryTime": "2025-01-20T13:30:00",
  "deliveryAddress": "ë¶€ì‚°ê´‘ì—­ì‹œ í•´ìš´ëŒ€êµ¬ ì„¼í…€ë¡œ 123",
  "notificationType": "ORDER_CONFIRMED",
  "requestedAt": "2025-01-15T10:30:15"
}
```

---

### ìˆ˜ì‹  ì´ë²¤íŠ¸ (Consumer)

#### 1. payment-refunded (Payment Service â†’ Order Service)

í™˜ë¶ˆ ì™„ë£Œ ì‹œ ì¬ê³  ë³µì› ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

**í† í”½**: `payment-refunded`

```json
{
  "eventId": "evt-uuid-004",
  "eventType": "PAYMENT_REFUNDED",
  "source": "payment-service",
  "timestamp": "2025-01-15T11:05:00",
  "paymentId": "payment-001",
  "orderId": "order-uuid-001",
  "refundAmount": 1500000.00,
  "totalRefundedAmount": 1500000.00,
  "refundReason": "ê³ ê° ìš”ì²­ìœ¼ë¡œ ì£¼ë¬¸ ì·¨ì†Œ",
  "pgRefundId": "pg-refund-001",
  "fullRefund": true,
  "refundedAt": "2025-01-15T11:05:00"
}
```

**ì²˜ë¦¬ ë¡œì§**:
```java
compensationService.handlePaymentRefunded(event);
// â†’ Inventory Serviceì— ì¬ê³  ë³µì› ìš”ì²­
```

---

#### 2. payment-refund-failed (Payment Service â†’ Order Service)

í™˜ë¶ˆ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ì²˜ë¦¬ ë° ìˆ˜ë™ ê°œì… ìš”ì²­ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

**í† í”½**: `payment-refund-failed`

```json
{
  "eventId": "evt-uuid-005",
  "eventType": "PAYMENT_REFUND_FAILED",
  "source": "payment-service",
  "timestamp": "2025-01-15T11:05:00",
  "paymentId": "payment-001",
  "orderId": "order-uuid-001",
  "requestedRefundAmount": 1500000.00,
  "errorMessage": "PGì‚¬ í†µì‹  ì˜¤ë¥˜",
  "failedAt": "2025-01-15T11:05:00"
}
```

**ì²˜ë¦¬ ë¡œì§**:
```java
compensationService.handlePaymentRefundFailed(event);
// â†’ Saga ìƒíƒœë¥¼ COMPENSATION_FAILEDë¡œ ë³€ê²½, ê´€ë¦¬ì ì•Œë¦¼
```

---

## í™˜ê²½ ì„¤ì •

### í™˜ê²½ ë³€ìˆ˜ (.env)

```properties
# ì„œë²„ ì„¤ì •
APP_PORT=4010

# ë°ì´í„°ë² ì´ìŠ¤
SPRING_DATASOURCE_URL=jdbc:postgresql://localhost:5432/order_db
SPRING_DATASOURCE_USERNAME=postgres
SPRING_DATASOURCE_PASSWORD=password

# Eureka
EUREKA_DEFAULT_ZONE=http://localhost:8761/eureka/

# Kafka
KAFKA_BOOTSTRAP_SERVERS=localhost:9092

# Keycloak
KEYCLOAK_ISSUER_URI=http://localhost:8080/realms/early-express

# Kafka Topics
KAFKA_TOPIC_REFUND_REQUESTED=refund-requested
KAFKA_TOPIC_PAYMENT_REFUNDED=payment-refunded
KAFKA_TOPIC_PAYMENT_REFUND_FAILED=payment-refund-failed
KAFKA_TOPIC_TRACKING_START_REQUESTED=tracking-start-requested
KAFKA_TOPIC_NOTIFICATION_EVENTS=notification-events

# Feign Client URLs (Eureka ì‚¬ìš© ì‹œ ì„œë¹„ìŠ¤ëª…ìœ¼ë¡œ ëŒ€ì²´)
INVENTORY_SERVICE_URL=http://inventory-service
PAYMENT_SERVICE_URL=http://payment-service
HUB_SERVICE_URL=http://hub-service
HUB_DELIVERY_SERVICE_URL=http://hub-delivery-service
LAST_MILE_DELIVERY_SERVICE_URL=http://last-mile-delivery-service
AI_SERVICE_URL=http://ai-service
```

### application.yml ì£¼ìš” ì„¤ì •

```yaml
spring:
  application:
    name: order-service
  
  kafka:
    consumer:
      group-id: order-service-group
      enable-auto-commit: false  # ìˆ˜ë™ ACK
      auto-offset-reset: earliest
    producer:
      acks: all

eureka:
  client:
    service-url:
      defaultZone: ${EUREKA_DEFAULT_ZONE}
```

---

## ì‹¤í–‰ ë°©ë²•

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­

- Java 21
- PostgreSQL 15+
- Apache Kafka
- Eureka Server
- Keycloak
- ì—°ë™ ì„œë¹„ìŠ¤ë“¤ (Inventory, Payment, Hub, Delivery, Track, Notification)

### ë¡œì»¬ ì‹¤í–‰

```bash
# 1. ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
createdb order_db

# 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
export $(cat .env | xargs)

# 3. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
./gradlew bootRun
```

### Docker ì‹¤í–‰

```bash
docker-compose up -d order-service
```

### Health Check

```bash
curl http://localhost:4010/actuator/health
```

---

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src/main/java/com/early_express/order_service/
â”œâ”€â”€ domain/order/
â”‚   â”œâ”€â”€ application/
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”‚   â””â”€â”€ OrderCreateCommand.java
â”‚   â”‚   â””â”€â”€ service/
â”‚   â”‚       â”œâ”€â”€ OrderCommandService.java
â”‚   â”‚       â”œâ”€â”€ OrderQueryService.java
â”‚   â”‚       â”œâ”€â”€ OrderSagaService.java
â”‚   â”‚       â””â”€â”€ OrderCompensationService.java
â”‚   â”‚
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ exception/
â”‚   â”‚   â”‚   â”œâ”€â”€ OrderErrorCode.java
â”‚   â”‚   â”‚   â”œâ”€â”€ OrderException.java
â”‚   â”‚   â”‚   â””â”€â”€ SagaException.java
â”‚   â”‚   â”œâ”€â”€ messaging/
â”‚   â”‚   â”‚   â”œâ”€â”€ notification/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ NotificationEventPublisher.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ NotificationRequestedEventData.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ event/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ NotificationRequestedEvent.java
â”‚   â”‚   â”‚   â”œâ”€â”€ payment/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PaymentEventPublisher.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ RefundRequestedEventData.java
â”‚   â”‚   â”‚   â””â”€â”€ tracking/
â”‚   â”‚   â”‚       â”œâ”€â”€ TrackingEventPublisher.java
â”‚   â”‚   â”‚       â”œâ”€â”€ TrackingStartRequestedEventData.java
â”‚   â”‚   â”‚       â””â”€â”€ event/
â”‚   â”‚   â”‚           â””â”€â”€ TrackingStartRequestedEvent.java
â”‚   â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”‚   â”œâ”€â”€ Order.java                    # Aggregate Root
â”‚   â”‚   â”‚   â”œâ”€â”€ OrderSaga.java                # Saga Aggregate
â”‚   â”‚   â”‚   â”œâ”€â”€ OrderStatus.java
â”‚   â”‚   â”‚   â”œâ”€â”€ SagaStatus.java
â”‚   â”‚   â”‚   â”œâ”€â”€ SagaStep.java
â”‚   â”‚   â”‚   â”œâ”€â”€ SagaStepHistory.java
â”‚   â”‚   â”‚   â”œâ”€â”€ StepStatus.java
â”‚   â”‚   â”‚   â””â”€â”€ vo/
â”‚   â”‚   â”‚       â”œâ”€â”€ OrderId.java
â”‚   â”‚   â”‚       â”œâ”€â”€ OrderNumber.java
â”‚   â”‚   â”‚       â”œâ”€â”€ SagaId.java
â”‚   â”‚   â”‚       â”œâ”€â”€ CompanyInfo.java
â”‚   â”‚   â”‚       â”œâ”€â”€ ProductInfo.java
â”‚   â”‚   â”‚       â”œâ”€â”€ AmountInfo.java
â”‚   â”‚   â”‚       â”œâ”€â”€ ReceiverInfo.java
â”‚   â”‚   â”‚       â”œâ”€â”€ RequestInfo.java
â”‚   â”‚   â”‚       â”œâ”€â”€ DeliveryInfo.java
â”‚   â”‚   â”‚       â”œâ”€â”€ DeliveryProgressInfo.java
â”‚   â”‚   â”‚       â”œâ”€â”€ AiCalculationResult.java
â”‚   â”‚   â”‚       â”œâ”€â”€ PgPaymentInfo.java
â”‚   â”‚   â”‚       â””â”€â”€ CompensationData.java
â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”‚       â”œâ”€â”€ OrderRepository.java
â”‚   â”‚       â””â”€â”€ OrderSagaRepository.java
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/
â”‚   â”‚   â”œâ”€â”€ client/                           # Feign Clients
â”‚   â”‚   â”‚   â”œâ”€â”€ inventory/
â”‚   â”‚   â”‚   â”œâ”€â”€ payment/
â”‚   â”‚   â”‚   â”œâ”€â”€ hub/
â”‚   â”‚   â”‚   â”œâ”€â”€ hubdelivery/
â”‚   â”‚   â”‚   â”œâ”€â”€ lastmiledelivery/
â”‚   â”‚   â”‚   â””â”€â”€ ai/
â”‚   â”‚   â”œâ”€â”€ messaging/
â”‚   â”‚   â”‚   â”œâ”€â”€ notification/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ producer/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ KafkaNotificationEventPublisher.java
â”‚   â”‚   â”‚   â”œâ”€â”€ payment/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ consumer/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PaymentRefundedEventConsumer.java
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ PaymentRefundFailedEventConsumer.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ event/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RefundRequestedEvent.java
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PaymentRefundedEvent.java
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ PaymentRefundFailedEvent.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ producer/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ KafkaPaymentEventPublisher.java
â”‚   â”‚   â”‚   â””â”€â”€ tracking/
â”‚   â”‚   â”‚       â””â”€â”€ producer/
â”‚   â”‚   â”‚           â””â”€â”€ KafkaTrackingEventPublisher.java
â”‚   â”‚   â””â”€â”€ persistence/
â”‚   â”‚       â”œâ”€â”€ OrderEntity.java
â”‚   â”‚       â”œâ”€â”€ OrderSagaEntity.java
â”‚   â”‚       â”œâ”€â”€ SagaStepHistoryEntity.java
â”‚   â”‚       â”œâ”€â”€ OrderJpaRepository.java
â”‚   â”‚       â””â”€â”€ OrderRepositoryImpl.java
â”‚   â”‚
â”‚   â””â”€â”€ presentation/
â”‚       â””â”€â”€ web/
â”‚           â”œâ”€â”€ common/
â”‚           â”‚   â””â”€â”€ dto/response/
â”‚           â”‚       â”œâ”€â”€ OrderSimpleResponse.java
â”‚           â”‚       â”œâ”€â”€ CompanyInfoDto.java
â”‚           â”‚       â”œâ”€â”€ ProductInfoDto.java
â”‚           â”‚       â”œâ”€â”€ AmountInfoDto.java
â”‚           â”‚       â”œâ”€â”€ ReceiverInfoDto.java
â”‚           â”‚       â”œâ”€â”€ RequestInfoDto.java
â”‚           â”‚       â”œâ”€â”€ DeliveryInfoDto.java
â”‚           â”‚       â”œâ”€â”€ DeliveryProgressInfoDto.java
â”‚           â”‚       â””â”€â”€ AiCalculationResultDto.java
â”‚           â”œâ”€â”€ companyuser/
â”‚           â”‚   â”œâ”€â”€ CompanyUserOrderController.java
â”‚           â”‚   â””â”€â”€ dto/
â”‚           â”‚       â”œâ”€â”€ request/
â”‚           â”‚       â”‚   â”œâ”€â”€ OrderCreateRequest.java
â”‚           â”‚       â”‚   â””â”€â”€ OrderCancelRequest.java
â”‚           â”‚       â””â”€â”€ response/
â”‚           â”‚           â”œâ”€â”€ OrderCreateResponse.java
â”‚           â”‚           â””â”€â”€ OrderDetailResponse.java
â”‚           â”œâ”€â”€ hubmanager/
â”‚           â”‚   â”œâ”€â”€ HubManagerOrderController.java
â”‚           â”‚   â””â”€â”€ dto/
â”‚           â”‚       â”œâ”€â”€ request/
â”‚           â”‚       â”‚   â”œâ”€â”€ HubOrderSearchRequest.java
â”‚           â”‚       â”‚   â””â”€â”€ OrderUpdateRequest.java
â”‚           â”‚       â””â”€â”€ response/
â”‚           â”‚           â””â”€â”€ HubOrderDetailResponse.java
â”‚           â””â”€â”€ master/
â”‚               â”œâ”€â”€ MasterOrderController.java
â”‚               â””â”€â”€ dto/
â”‚                   â”œâ”€â”€ request/
â”‚                   â”‚   â””â”€â”€ OrderSearchRequest.java
â”‚                   â””â”€â”€ response/
â”‚                       â”œâ”€â”€ MasterOrderDetailResponse.java
â”‚                       â””â”€â”€ OrderSagaInfoDto.java
â”‚
â””â”€â”€ global/
    â”œâ”€â”€ common/
    â”‚   â”œâ”€â”€ dto/
    â”‚   â”‚   â””â”€â”€ PageInfo.java
    â”‚   â””â”€â”€ utils/
    â”‚       â””â”€â”€ UuidUtils.java
    â”œâ”€â”€ infrastructure/
    â”‚   â””â”€â”€ event/
    â”‚       â””â”€â”€ base/
    â”‚           â””â”€â”€ BaseEvent.java
    â””â”€â”€ presentation/
        â””â”€â”€ dto/
            â”œâ”€â”€ ApiResponse.java
            â””â”€â”€ PageResponse.java
```

---

## ë³´ì•ˆ

- **OAuth 2.0 Resource Server**: Keycloak JWT í† í° ê²€ì¦
- **ì—­í• ë³„ API ë¶„ë¦¬**:
    - Company User: `X-User-Id`, `X-Company-Id` í—¤ë”
    - Hub Manager: `X-Hub-Id` í—¤ë”
    - Master: ê´€ë¦¬ì ê¶Œí•œ í•„ìš”
- **ë¯¼ê° ì •ë³´ ì ‘ê·¼ ì œì–´**:
    - PG ê²°ì œ í‚¤: Masterë§Œ ì¡°íšŒ ê°€ëŠ¥
    - Saga ì •ë³´: Masterë§Œ ì¡°íšŒ ê°€ëŠ¥

---

## ëª¨ë‹ˆí„°ë§

- **Actuator**: `/actuator/health`, `/actuator/info`
- **Zipkin**: ë¶„ì‚° ì¶”ì  (Saga Stepë³„ ì¶”ì )
- **Loki**: ë¡œê·¸ ìˆ˜ì§‘
- **Prometheus Pushgateway**: ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- **Saga ëª¨ë‹ˆí„°ë§**: `/v1/order/web/master/orders/{id}/saga`

---

## ê´€ë ¨ ì„œë¹„ìŠ¤

| ì„œë¹„ìŠ¤ | ì—°ë™ ë°©ì‹ | ì—­í•  |
|--------|----------|------|
| **Inventory Service** | Feign | ì¬ê³  ì˜ˆì•½/í•´ì œ/í™•ì • |
| **Payment Service** | Feign + Kafka | ê²°ì œ ê²€ì¦, í™˜ë¶ˆ ìš”ì²­/ì™„ë£Œ |
| **Hub Service** | Feign | ê²½ë¡œ ê³„ì‚°, ë„ì°© í—ˆë¸Œ ê²°ì • |
| **AI Service** | Feign | ë°°ì†¡ ì‹œê°„ ê³„ì‚° |
| **Hub Delivery Service** | Feign | í—ˆë¸Œ ë°°ì†¡ ìƒì„±/ì·¨ì†Œ |
| **Last Mile Delivery Service** | Feign | ìµœì¢… ë°°ì†¡ ìƒì„±/ì·¨ì†Œ |
| **Track Service** | Kafka | ë°°ì†¡ ì¶”ì  ì‹œì‘ ìš”ì²­ |
| **Notification Service** | Kafka | ì•Œë¦¼ ë°œì†¡ ìš”ì²­ |

---